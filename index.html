<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bin Day</title>
  <meta name="theme-color" content="#0b1220" />
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; margin: 0; padding: 24px; }
    .wrap { max-width: 640px; margin: 0 auto; }
    .card { border: 1px solid rgba(127,127,127,.25); border-radius: 18px; padding: 18px; }
    h1 { margin: 0 0 10px; font-size: 22px; }
    .muted { opacity: .7; font-size: 14px; }
    .pill { display: flex; gap: 12px; align-items: center; padding: 12px; border-radius: 16px; border: 1px solid rgba(127,127,127,.25); margin-top: 12px; }
    .icons { display:flex; gap:10px; align-items:center; }
    .icon { width: 44px; height: 44px; }
    .big { font-size: 24px; font-weight: 850; line-height: 1.1; margin: 0; }
    .sub { margin-top: 6px; font-size: 15px; opacity: .8; }
    .small { margin-top: 4px; font-size: 13px; opacity: .75; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 14px; }
    button { border-radius: 12px; padding: 10px 12px; border: 1px solid rgba(127,127,127,.35); background: transparent; font: inherit; cursor: pointer; }
    button:active { transform: translateY(1px); }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <h1>Bin Day</h1>
    <div class="muted" id="today"></div>

    <div class="pill" id="pill" style="display:none;">
      <div class="icons" id="icons"></div>
      <div>
        <p class="big" id="headline"></p>
        <div class="sub" id="dateLine"></div>
        <div class="small" id="detailLine"></div>
      </div>
    </div>

    <div class="row">
      <button id="addNext">Add next reminder</button>
      <button id="addYear">Download full year for Google Calendar</button>
    </div>
  </div>
</div>

<script>
/* ================= CONFIG ================= */

// Recycling alternates weekly
const RECYCLING = ["Mixed Recycling", "Paper & Card"];

// Anchor recycling colour (Thu 5 Feb 2026 = Paper)
const recyclingAnchorDate = new Date(2026, 1, 5, 12, 0, 0);
const recyclingAnchorIndex = 1; // Paper & Card

// Black bin fortnight (alone)
const blackBinAnchorDate = new Date(2026, 1, 12, 12, 0, 0); // known black-bin-only Thursday

// Garden season
const gardenSeasonStart = new Date(2026, 2, 27, 12, 0, 0); // 27 March 2026

// December exceptions
const overrides = {
  "2026-12-23": ["General Waste"],
  "2026-12-31": ["Paper & Card"]
};

const noCollection = new Set(["2026-12-24"]);

const colours = {
  "Garden Waste": "#2e7d32",
  "General Waste": "#111111",
  "Paper & Card": "#7b1fa2",
  "Mixed Recycling": "#1565c0"
};

const plain = {
  "Garden Waste": "Green bin",
  "General Waste": "Black bin",
  "Paper & Card": "Purple bin",
  "Mixed Recycling": "Blue bin"
};

/* ================= HELPERS ================= */

const pad = n => String(n).padStart(2,"0");
const key = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
const isThu = d => d.getDay() === 4;
const weeksBetween = (a,b) => Math.floor((b - a) / (1000*60*60*24*7));

function recyclingFor(date){
  const w = weeksBetween(recyclingAnchorDate, date);
  return RECYCLING[(recyclingAnchorIndex + w) % 2];
}

function isBlackBinWeek(date){
  const w = weeksBetween(blackBinAnchorDate, date);
  return w % 2 === 0;
}

/* ================= CORE LOGIC ================= */

function binsForDate(date){
  const k = key(date);
  if (noCollection.has(k)) return null;
  if (overrides[k]) return overrides[k];
  if (!isThu(date)) return null;

  // Black bin weeks are always alone
  if (isBlackBinWeek(date)) {
    return ["General Waste"];
  }

  // Otherwise recycling week
  const bins = [recyclingFor(date)];

  // Add garden if in season
  if (date >= gardenSeasonStart) {
    bins.push("Garden Waste");
  }

  return bins;
}

function nextCollection(from){
  const d = new Date(from);
  d.setHours(12,0,0,0);
  for (let i=1;i<=21;i++){
    const x = new Date(d);
    x.setDate(x.getDate()+i);
    const bins = binsForDate(x);
    if (bins) return { date:x, bins };
  }
  return null;
}

/* ================= UI ================= */

function binSVG(col){
  return `<svg viewBox="0 0 64 64" width="44" height="44">
    <rect x="16" y="18" width="32" height="38" rx="6" fill="${col}"/>
    <rect x="14" y="14" width="36" height="8" rx="4" fill="${col}"/>
  </svg>`;
}

const today = new Date();
document.getElementById("today").textContent =
  today.toLocaleDateString(undefined,{weekday:"long",year:"numeric",month:"long",day:"numeric"});

const next = nextCollection(today);
if (next){
  document.getElementById("pill").style.display="flex";
  const icons = document.getElementById("icons");
  icons.innerHTML = "";
  next.bins.forEach(b => icons.innerHTML += `<div class="icon">${binSVG(colours[b])}</div>`);

  document.getElementById("headline").textContent =
    next.bins.map(b=>plain[b]).join(" + ") + " out";

  document.getElementById("dateLine").textContent =
    "Next collection: " + next.date.toDateString();

  document.getElementById("detailLine").textContent =
    "Official: " + next.bins.join(" + ");
}
</script>
</body>
</html>
